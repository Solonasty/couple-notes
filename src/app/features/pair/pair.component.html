<mat-card>
  <mat-card-content>
    <h3>Ваша пара:</h3>

    @if (myProfile()?.pairId) {
      <p style="margin: 8px 0;">
        Вы в паре с: <b>{{ myProfile()?.partnerEmail ?? myProfile()?.partnerUid }}</b>
      </p>

      <button mat-raised-button color="warn"
              [disabled]="saving()"
              (click)="breakPair()">
        Разорвать пару
      </button>
    } @else {
      <p style="margin: 8px 0;">Вы пока не в паре</p>
    }

    @if (error()) { <div class="error">{{ error() }}</div> }
    @if (ok()) { <div class="ok">{{ ok() }}</div> }

    <hr style="margin: 16px 0;" />

    <h3>Отправленные приглашения:</h3>

    @if (outgoingInvites().length === 0) {
      <p style="margin: 8px 0;">Нет отправленных приглашений</p>
    } @else {
      @for (inv of outgoingInvites(); track inv.id) {
        <p style="margin: 8px 0;">
          Кому: <b>{{ inv.toEmail }}</b>
        </p>
      }
    }

    <hr style="margin: 16px 0;" />

    <h3>Полученые приглашения:</h3>

    @if (incomingInvites().length === 0) {
      <p style="margin: 8px 0;">Нет приглашений</p>
    } @else {
      @for (inv of incomingInvites(); track inv.id) {
        <div style="display:flex; gap:12px; align-items:center; margin:8px 0;">
          <div style="flex:1;">
            От: <b>{{ inv.fromEmail }}</b>
          </div>

          <button mat-raised-button color="primary"
                  [disabled]="saving()"
                  (click)="acceptInvite(inv.id)">
            Принять
          </button>

          <button mat-button
                  [disabled]="saving()"
                  (click)="declineInvite(inv.id)">
            Отклонить
          </button>
        </div>
      }
    }

    <hr style="margin: 16px 0;" />

    @if (canShowInviteForm()) {
      <h4>Пригласить партнёра</h4>
      <form [formGroup]="pairForm" (ngSubmit)="createInvite()">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Email партнёра</mat-label>
          <input matInput formControlName="partnerEmail" autocomplete="email" />
        </mat-form-field>

        <button mat-raised-button color="primary"
                type="submit"
                [disabled]="pairForm.invalid || saving()">
          Отправить приглашение
        </button>
      </form>
    } @else {
      <p style="margin: 8px 0;">
        Форма приглашения скрыта, потому что у вас есть активная пара или активное приглашение.
        (Если приглашение отклонено — форма появится автоматически.)
      </p>
    }
  </mat-card-content>
</mat-card>
